#!/usr/bin/env python
"""
Pre-commit hook to automatically format Python files with Black.
Install: Copy to .git/hooks/pre-commit and make executable
"""

import subprocess
import sys

def main():
    """Run Black on staged Python files."""
    # Get staged Python files
    result = subprocess.run(
        ["git", "diff", "--cached", "--name-only", "--diff-filter=ACM"],
        capture_output=True,
        text=True
    )
    
    staged_files = [
        f for f in result.stdout.strip().split('\n')
        if f.endswith('.py') and f
    ]
    
    if not staged_files:
        return 0
    
    print("üé® Running Black formatter on staged files...")
    
    # Run Black
    result = subprocess.run(
        ["black"] + staged_files,
        capture_output=True,
        text=True
    )
    
    if result.returncode != 0:
        print("‚ùå Black formatting failed:")
        print(result.stderr)
        return 1
    
    # Re-stage formatted files
    subprocess.run(["git", "add"] + staged_files)
    
    print(f"‚úÖ Formatted {len(staged_files)} file(s)")
    return 0

if __name__ == "__main__":
    sys.exit(main())
